<!DOCTYPE html>
<!--
	Copyright (c) 2014-2023, CKSource Holding sp. z o.o. All rights reserved.
	This file is licensed under the terms of the MIT License (see LICENSE.md).
-->

<html lang="en" dir="ltr">

<head>
	<title>CKEditor 5 ClassicEditor build</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" type="image/png" href="https://c.cksource.com/a/1/logos/ckeditor5.png">
	<link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body data-editor="ClassicEditor" data-collaboration="false" data-revision-history="false">
	<header>
		<div class="centered">
			<h1><a href="https://ckeditor.com/ckeditor-5/" target="_blank" rel="noopener noreferrer"><img
						src="https://c.cksource.com/a/1/logos/ckeditor5.svg" alt="CKEditor 5 logo">CKEditor 5</a></h1>
			<nav>
				<ul>
					<li><a href="https://ckeditor.com/docs/ckeditor5/" target="_blank"
							rel="noopener noreferrer">Documentation</a></li>
					<li><a href="https://ckeditor.com/" target="_blank" rel="noopener noreferrer">Website</a></li>
				</ul>
			</nav>
		</div>
	</header>
	<main>
		<div class="message">
			<div class="centered">
				<h2>CKEditor 5 online builder demo - ClassicEditor build</h2>
			</div>
		</div>
		<div class="centered">
			<div class="row row-editor">
				<div class="editor-container">
					<div class="editor" id="editor">
					</div>
				</div>
			</div>
		</div>
		</div>
	</main>
	<footer>
		<p><a href="https://ckeditor.com/ckeditor-5/" target="_blank" rel="noopener">CKEditor 5</a>
			– Rich text editor of tomorrow, available today
		</p>
		<p>Copyright © 2003-2023,
			<a href="https://cksource.com/" target="_blank" rel="noopener">CKSource</a>
			Holding sp. z o.o. All rights reserved.
		</p>
	</footer>
	<script src="../build/ckeditor.js"></script>
	<script>

		// Filtering function - it uses `name` and `username` properties of an item to find a match.
		function isItemMatching(item, queryText) {
			// Make the search case-insensitive.
			const searchString = queryText.toLowerCase();

			// Include an item in the search results if name or username includes the current user input.
			return (
				item.name.toLowerCase().includes(searchString)
			);
		}

		const items = [
			{ id: '@swarley', userId: '1', name: 'Barney Stinson', link: 'https://www.imdb.com/title/tt0460649/characters/nm0000439' },
			{ id: '@lilypad', userId: '2', name: 'Lily Aldrin', link: 'https://www.imdb.com/title/tt0460649/characters/nm0004989' },
			{ id: '@marry', userId: '3', name: 'Marry Ann Lewis', link: 'https://www.imdb.com/title/tt0460649/characters/nm1130627' },
			{ id: '@marshmallow', userId: '4', name: 'Marshall Eriksen', link: 'https://www.imdb.com/title/tt0460649/characters/nm0781981' },
			{ id: '@rsparkles', userId: '5', name: 'Robin Scherbatsky', link: 'https://www.imdb.com/title/tt0460649/characters/nm1130627' },
			{ id: '@tdog', userId: '6', name: 'Ted Mosby', link: 'https://www.imdb.com/title/tt0460649/characters/nm1102140' }
		];

		function getFeedItems(queryText, list) {
			// As an example of an asynchronous action, return a promise
			// that resolves after a 100ms timeout.
			// This can be a server request or any sort of delayed action.
			return new Promise(resolve => {
				setTimeout(() => {
					const itemsToDisplay = list
						// Filter out the full list of all items to only those matching the query text.
						.filter(item => isItemMatching(item, queryText))
						// Return 10 items max - needed for generic queries when the list may contain hundreds of elements.
						.slice(0, 10);

					resolve(itemsToDisplay);
				}, 100);
			});
		}

		const getWikiItems = (queryText) => {
			// As an example of an asynchronous action, return a promise
			// that resolves after a 100ms timeout.
			// This can be a server request or any sort of delayed action.
			return new Promise((resolve) => {
				
				setTimeout(() => {
					const wikiItems = [
						{
							id: "swarley",
							userId: "1",
							name: "Barney Stinson",
							link: "https://www.imdb.com/title/tt0460649/characters/nm0000439",
						},
						{
							id: "#lilypad",
							userId: "2",
							name: "Lily Aldrin",
							link: "https://www.imdb.com/title/tt0460649/characters/nm0004989",
						},
						{
							id: "marry",
							userId: "3",
							name: "Marry Ann Lewis",
							link: "https://www.imdb.com/title/tt0460649/characters/nm1130627",
						},  
						{
							id: "marshmallow",
							userId: "4",
							name: "Marshall Eriksen",
							link: "https://www.imdb.com/title/tt0460649/characters/nm0781981",
						},
						{
							id: "rsparkles",
							userId: "5",
							name: "Robin Scherbatsky",
							link: "https://www.imdb.com/title/tt0460649/characters/nm1130627",
						},
						{
							id: "tdog",
							userId: "6",
							name: "Ted Mosby",
							link: "https://www.imdb.com/title/tt0460649/characters/nm1102140",
						},
					];
					console.log("queryText..,", queryText);

					if (queryText.startsWith("\[\[")) {
						queryText = queryText.slice(2)
					}
					console.log("queryText>>>>", queryText);

					const itemsToDisplay = wikiItems
						// Filter out the full list of all items to only those matching the query text.
						.filter(item => isItemMatching(item, queryText))
						// Return 10 items max - needed for generic queries when the list may contain hundreds of elements.
						.slice(0, 10);

					console.log("items>>>>", itemsToDisplay)

					resolve(itemsToDisplay);
				}, 1000);
			});
		}

		function customItemRenderer(item) {
			const itemElement = document.createElement('span');

			itemElement.classList.add('custom-item');
			itemElement.id = `mention-list-item-id-${item.userId}`;
			itemElement.textContent = `${item.name} `;

			const usernameElement = document.createElement('span');

			usernameElement.classList.add('custom-item-username');
			usernameElement.textContent = item.id;

			itemElement.appendChild(usernameElement);

			return itemElement;
		}


		ClassicEditor
			.create(document.querySelector('.editor'), {

				licenseKey: '',

				// onChange: (event, editor) => {
				// 	const data = editor.getData();
				// 	console.log("onChange...", { event, editor, data });
				// }

				mention: {
					dropdownLimit: 4,
					feeds: [
						{
							marker: '@',
							feed: (text) => getFeedItems(text, items),
							itemRenderer: customItemRenderer
						},
					]
				},
				wiki: {
					feeds: [
						{
							marker: "[[",
							feed: getWikiItems,
							itemRenderer: customItemRenderer
						}
					]
				},
			})
			.then(editor => {
				window.editor = editor;
			})
			.catch(error => {
				console.error('Oops, something went wrong!');
				console.error('Please, report the following error on https://github.com/ckeditor/ckeditor5/issues with the build id and the error stack trace:');
				console.warn('Build id: 3jc6ymj9ma6z-5kg9djlyr62b');
				console.error(error);
			});
	</script>

	<script>
		document.getElementById("editor").addEventListener("click", (e) => {

			console.log(e.target);
			
		})
	</script>
</body>

</html>